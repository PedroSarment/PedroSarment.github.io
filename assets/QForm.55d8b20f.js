import{c as I,h as E,r as j,p as B,x as R,y as V,o as Q,g as D,v as C,j as O,q as W}from"./index.98d0e2c4.js";import{c as k,h as w}from"./QIcon.028dc21d.js";import{d as K}from"./QBtn.7685af77.js";let i=[],d=[];function A(e){d=d.filter(u=>u!==e)}function G(e){A(e),d.push(e)}function H(e){A(e),d.length===0&&i.length!==0&&(i[i.length-1](),i=[])}function M(e){d.length===0?e():i.push(e)}function J(e){i=i.filter(u=>u!==e)}const L={name:String};function U(e={}){return(u,f,h)=>{u[f](E("input",{class:"hidden"+(h||""),...e.value}))}}function X(e){return I(()=>e.name||e.for)}var Y=k({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:u,emit:f}){const h=D(),c=j(null);let l=0;const s=[];function g(t){const r=typeof t=="boolean"?t:e.noErrorFocus!==!0,v=++l,x=(o,n)=>{f("validation"+(o===!0?"Success":"Error"),n)},S=o=>{const n=o.validate();return typeof n.then=="function"?n.then(a=>({valid:a,comp:o}),a=>({valid:!1,comp:o,err:a})):Promise.resolve({valid:n,comp:o})};return(e.greedy===!0?Promise.all(s.map(S)).then(o=>o.filter(n=>n.valid!==!0)):s.reduce((o,n)=>o.then(()=>S(n).then(a=>{if(a.valid===!1)return Promise.reject(a)})),Promise.resolve()).catch(o=>[o])).then(o=>{if(o===void 0||o.length===0)return v===l&&x(!0),!0;if(v===l){const{comp:n,err:a}=o[0];if(a!==void 0&&console.error(a),x(!1,n),r===!0){const P=o.find(({comp:q})=>typeof q.focus=="function"&&K(q.$)===!1);P!==void 0&&P.comp.focus()}}return!1})}function F(){l++,s.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function b(t){t!==void 0&&C(t);const r=l+1;g().then(v=>{r===l&&v===!0&&(e.onSubmit!==void 0?f("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function p(t){t!==void 0&&C(t),f("reset"),O(()=>{F(),e.autofocus===!0&&e.noResetFocus!==!0&&m()})}function m(){M(()=>{if(c.value===null)return;const t=c.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||c.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||c.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(c.value.querySelectorAll("[tabindex]"),r=>r.tabIndex>-1);t!=null&&t.focus({preventScroll:!0})})}B(W,{bindComponent(t){s.push(t)},unbindComponent(t){const r=s.indexOf(t);r>-1&&s.splice(r,1)}});let y=!1;return R(()=>{y=!0}),V(()=>{y===!0&&e.autofocus===!0&&m()}),Q(()=>{e.autofocus===!0&&m()}),Object.assign(h.proxy,{validate:g,resetValidation:F,submit:b,reset:p,focus:m,getValidationComponents:()=>s}),()=>E("form",{class:"q-form",ref:c,onSubmit:b,onReset:p},w(u.default))}});export{Y as Q,M as a,X as b,H as c,G as d,U as e,J as r,L as u};
